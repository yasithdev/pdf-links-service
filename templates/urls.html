<!DOCTYPE html>
<head>
  <title>PDF Links Service</title>
  <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" rel="stylesheet">
  <script>
    window.robustify = function (urls) {
      const decoder = new TextDecoder('utf-8');
      document.getElementsByName("url").forEach(e => {
        e.setAttribute("disabled", "");
      })
      fetch("/robustify", {
        method: "post",
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(urls)
      })
        .then(response => response.body.getReader())
        .then(async reader => {
          while (true) {
            const {done, value} = await reader.read();
            if (done) {
              document.getElementsByName("url").forEach(e => {
                e.removeAttribute("disabled");
              })
              break;
            }
            document.getElementById("log").innerHTML += decoder.decode(value);
          }
        })
    }
  </script>
</head>
<body>
<nav class="navbar navbar-dark bg-dark mb-2">
  <a class="navbar-brand ms-2" href="/">PDF Links Service</a>
</nav>
<div class="container">
  <div class="row">
    <div class="col-6">
      <h2>Extracted Links</h2>
      <h3 class="text-muted">{{filename}}</h3>
      <table class="table table-sm table-hover">
        <thead>
        <tr>
          <th>URL</th>
          <th>Actions</th>
        </tr>
        </thead>
        {% for url in urls %}
        <tr>
          <td class="w-100" style="white-space: nowrap; text-overflow:ellipsis; overflow: hidden; max-width:0;">{{url}}
          </td>
          <td>
            <button
              class="btn btn-primary btn-sm"
              data-url='{{url | safe}}'
              name="url"
              onclick="window.robustify([this.dataset.url])">
              Robustify
            </button>
          </td>
        </tr>
        {% endfor %}
        <tfoot>
        <tr>
          <td colspan="2">
            <button
              class="btn btn-primary btn-sm w-100"
              data-urls='{{urls | tojson}}'
              name="url"
              onclick="window.robustify(JSON.parse(this.dataset.urls))">
              Robustify All
            </button>
          </td>
        </tr>
        </tfoot>
      </table>
    </div>
    <div class="col-6">
      <h2>Robustify Log</h2>
      <p>This section will display the log for link robustification.</p>
      <pre class="w-100 h-100" id="log"
           style="border: 1px solid black;
           word-wrap: break-word;
           white-space: pre-wrap;
           overflow-x: auto;
           overflow-y: scroll;
           max-height: 80vh;"></pre>
    </div>
  </div>
</div>
</body>
